# Tên của quy trình CI (Continuous Integration)
name: .NET CI Build and Test

# Kích hoạt workflow này khi có push hoặc pull request vào nhánh 'main'
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # Chạy trên máy ảo Ubuntu mới nhất (do GitHub cung cấp)
    runs-on: ubuntu-latest

    # ⭐️ GIẢI QUYẾT LỖI MSB1003 TẠI ĐÂY ⭐️
    # Chúng ta đặt thư mục làm việc mặc định cho TẤT CẢ các lệnh "run:"
    # Bạn PHẢI thay đổi 'TenThuMucChuaFileSLN' thành tên thư mục thực tế của bạn
    # Ví dụ: nếu file của bạn ở 'MyProject/MyProject.sln', bạn điền: ./MyProject
    defaults:
      run:
        working-directory: ./DemoGitHubWeb

    steps:
    # Bước 1: Checkout (Tải code về máy ảo) - BẮT BUỘC
    - name: Checkout repository
      uses: actions/checkout@v4

    # Bước 2: Cài đặt .NET SDK (thay 8.0.x bằng phiên bản của bạn nếu cần)
    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    # Bước 3: Restore (Khôi phục các gói NuGet)
    # Lệnh này sẽ tự động chạy bên trong thư mục bạn đã chỉ định ở "defaults"
    - name: Restore dependencies
      run: dotnet restore

    # Bước 4: Build (Biên dịch dự án)
    - name: Build project
      # Thêm --no-restore vì chúng ta vừa restore ở bước trên, không cần làm lại
      run: dotnet build --no-restore

    # Bước 5: Test (Chạy mọi unit test có trong solution)
    - name: Run tests
      # Thêm --no-build vì chúng ta vừa build ở bước trên
      run: dotnet test --no-build
